---
# ============================================================================
# PostgreSQL: n8n Application Database Objects
# File: group_vars/n8n/postgresql.yml
# Role: anxs.postgresql
# ============================================================================
#
# Applied to: All hosts in 'n8n' group
# Variable precedence: Overrides all previous layers
#
# Defines n8n-specific database, user, privileges.
# Password referenced from host_vars (SOPS-encrypted).
# Uses postgresql_defaults.db from group_vars/all/ for consistency.
# ============================================================================

# --- ROLE: Database Creation ---
postgresql_databases:
  - name: n8n
    owner: n8n_user
    # Use repository defaults for locale/encoding/template
    lc_collate: "{{ postgresql_defaults.db.lc_collate }}"
    lc_ctype: "{{ postgresql_defaults.db.lc_ctype }}"
    encoding: "{{ postgresql_defaults.db.encoding }}"
    template: "{{ postgresql_defaults.db.template }}"
    state: present

# --- ROLE: User Creation ---
postgresql_users:
  - name: n8n_user
    pass: "{{ n8n_db_password }}"
    encrypted: yes
    state: present

# --- ROLE: User Privileges ---
postgresql_user_privileges:
  - name: n8n_user
    db: n8n
    priv: "ALL"
    role_attr_flags: "NOCREATEDB,NOSUPERUSER"
