---
# ============================================================================
# PostgreSQL: Hardware Tuning for N150
# File: group_vars/hw_n150/postgresql.yml
# Role: anxs.postgresql
# ============================================================================
#
# Hardware profile: N150 mini cube
# - RAM: 12GB
# - Storage: 512GB SSD
# - CPU: x86_64 (multi-core)
#
# Applied to: All hosts in 'hw_n150' group
# Variable precedence: Overrides all/ and db/, overridden by app/ → host_vars/
#
# Tuning based on PostgreSQL wiki guidelines for mixed workload.
# References: https://wiki.postgresql.org/wiki/Tuning_Your_PostgreSQL_Server
# ============================================================================

# --- ROLE: Memory Settings ---
# Based on 12GB total RAM

# shared_buffers: 25% of RAM for dedicated database server
postgresql_shared_buffers: "3GB"

# effective_cache_size: Estimate of memory for disk caching (50-75% RAM)
postgresql_effective_cache_size: "8GB"

# work_mem: Memory per sort/hash operation
# Formula: (RAM - shared_buffers) / max_connections / 3
# (12GB - 3GB) / 100 / 3 ≈ 30MB
postgresql_work_mem: "30MB"

# maintenance_work_mem: Memory for VACUUM, CREATE INDEX (5% of RAM)
postgresql_maintenance_work_mem: "512MB"

# --- ROLE: WAL Settings (SSD-optimized) ---
postgresql_wal_buffers: "16MB"
postgresql_checkpoint_completion_target: 0.9

# --- ROLE: Query Planner (SSD optimization) ---
# SSD has low random access cost compared to sequential
postgresql_random_page_cost: 1.1
postgresql_effective_io_concurrency: 200
