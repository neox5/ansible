---
# ============================================================================
# n8n: Lab Configuration
# File: group_vars/n8n/n8n.yml
# Role: n8n (custom)
# ============================================================================
#
# Lab environment configuration for n8n workflow automation.
# Deployed via Podman Quadlet with PostgreSQL backend.
#
# Variable precedence:
#   all â†' db â†' n8n (this file) â†' host_vars
#
# ============================================================================

# --- Version ---
n8n_version: "latest"

# --- Network Configuration ---
n8n_host: "n8n.lab.local"
n8n_port: 5678
n8n_webhook_url: "https://n8n.lab.local/"
n8n_domain: "n8n.lab.local"

# --- Database Configuration ---
n8n_db_host: "localhost"
n8n_db_port: 5432
n8n_db_name: "n8n"
n8n_db_user: "n8n_user"
n8n_db_password: "{{ n8n_db_password_secret }}"

# --- Security Configuration ---
n8n_encryption_key: "{{ n8n_encryption_key_secret }}"
n8n_block_env_access: true

# --- Timezone ---
n8n_timezone: "UTC"

# --- Container Configuration ---
n8n_container_name: "n8n"
n8n_data_volume: "n8n_data"
n8n_data_dir: "/var/lib/containers/storage/volumes/n8n_data/_data"

# --- Health Check Configuration ---
n8n_health_check_interval: "30s"
n8n_health_check_timeout: "10s"
n8n_health_check_retries: 3
n8n_health_check_start_period: "30s"

# --- systemd Configuration ---
n8n_systemd_timeout_start: 300
n8n_systemd_restart_sec: 15
n8n_systemd_start_limit_burst: 5
n8n_systemd_start_limit_interval: 600

# --- Deployment Validation Timeouts ---
n8n_port_wait_timeout: 60
n8n_readiness_retries: 12
n8n_readiness_delay: 5

# --- PostgreSQL Readiness Check ---
postgres_ready_retries: 10
postgres_ready_delay: 3

# ============================================================================
# Notes:
# - Lab configuration uses HTTPS with self-signed certificates
# - Access via: https://n8n.lab.local (browser security warning expected)
# - Caddy terminates HTTPS, proxies to n8n via HTTP on localhost
# - Database credentials referenced from host_vars secrets.sops.yml
# - Encryption key referenced from host_vars secrets.sops.yml
# - PostgreSQL database created via postgresql role configuration
# - Container deployed via quadlet role (called by n8n role)
# ============================================================================
