---
# PostgreSQL Custom Role - Configuration Defaults

# PostgreSQL version (MUST be 17 for this role)
postgresql_version: 17

# Connection settings
postgresql_listen_addresses: "localhost"
postgresql_port: 5432
postgresql_max_connections: 100

# Memory settings (override in inventory based on hardware)
postgresql_shared_buffers: "128MB"
postgresql_effective_cache_size: "4GB"
postgresql_work_mem: "4MB"
postgresql_maintenance_work_mem: "64MB"

# WAL settings
postgresql_wal_level: "replica"
postgresql_wal_buffers: "16MB"
postgresql_checkpoint_completion_target: 0.9

# Query tuning (override for SSD vs HDD)
postgresql_random_page_cost: 4.0 # 1.1 for SSD, 4.0 for HDD
postgresql_effective_io_concurrency: 2 # 200 for SSD, 2 for HDD

# Logging
postgresql_log_destination: "stderr"
postgresql_logging_collector: true
postgresql_log_directory: "log"
postgresql_log_filename: "postgresql-%Y-%m-%d_%H%M%S.log"
postgresql_log_rotation_age: "1d"
postgresql_log_rotation_size: "10MB"
postgresql_log_line_prefix: "%m [%p] %q%u@%d "
postgresql_log_timezone: "UTC"

# Locale settings
postgresql_locale: "en_US.UTF-8"
postgresql_encoding: "UTF-8"

# Client authentication (pg_hba.conf)
postgresql_pg_hba_default:
  - comment: "Local Unix socket connections"
    type: "local"
    database: "all"
    user: "all"
    address: ""
    method: "peer"

  - comment: "IPv4 local connections"
    type: "host"
    database: "all"
    user: "all"
    address: "127.0.0.1/32"
    method: "scram-sha-256"

  - comment: "IPv6 local connections"
    type: "host"
    database: "all"
    user: "all"
    address: "::1/128"
    method: "scram-sha-256"

# Custom pg_hba rules (append to defaults)
postgresql_pg_hba_custom: []

# Databases to create
postgresql_databases: []

# Users to create
postgresql_users: []

# Backup configuration
postgresql_backup_dir: "/var/backups/postgresql"
postgresql_backup_retention_days: 7
postgresql_backup_format: "custom" # custom, plain, directory, tar

# Scripts installation
postgresql_install_scripts: true
postgresql_scripts_dir: "/usr/local/bin"
