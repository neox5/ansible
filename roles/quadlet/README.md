# Quadlet Role

Generic Quadlet role for deploying containerized services via Podman systemd integration.

## Constraints

**This role ONLY supports:**

- Debian 13 (Trixie)
- Podman 5.4+
- System-level (rootful) containers

**This is intentional.** User-level (rootless) support and multi-distro support can be added later if needed.

## Requirements

- Debian 13 Trixie
- Ansible 2.15+
- containers.podman collection

## Role Design

This role is designed to be **called by application-specific roles**, not used directly in playbooks.

Application roles (n8n, nextcloud, etc.) call this role with their specific container configuration.

## Role Variables

### Required Variables (must be set by calling role)

```yaml
quadlet_name: "" # Container name
quadlet_image: "" # Container image
```

### Optional Variables

```yaml
# Container configuration
quadlet_command: "" # Command to execute
quadlet_environment: {} # Environment variables dict
quadlet_ports: [] # Port mappings ["host:container"]
quadlet_volumes: [] # Volume mounts ["source:dest:options"]
quadlet_network: "" # Network name

# Systemd integration
quadlet_service_enabled: true # Enable service
quadlet_service_state: started # Service state (started/stopped)
quadlet_auto_update: false # Enable podman auto-update
quadlet_restart_policy: "always" # Restart policy

# Advanced options
quadlet_capabilities: [] # Container capabilities
quadlet_security_opt: [] # Security options
```

See `defaults/main.yml` for all available variables.

## Example Usage

**In application role (roles/n8n/tasks/main.yml):**

```yaml
---
- name: Deploy n8n container
  include_role:
    name: quadlet
  vars:
    quadlet_name: n8n
    quadlet_image: docker.io/n8nio/n8n:latest
    quadlet_environment:
      DB_TYPE: postgresdb
      DB_POSTGRESDB_HOST: localhost
      DB_POSTGRESDB_USER: n8n_user
      DB_POSTGRESDB_PASSWORD: "{{ n8n_db_password }}"
    quadlet_ports:
      - "5678:5678"
    quadlet_volumes:
      - "n8n_data:/home/node/.n8n"
```

## Tags

- `quadlet` - All tasks
- `quadlet-preflight` - Environment validation
- `quadlet-install` - Package installation
- `quadlet-deploy` - Container deployment

## What This Role Does

1. Validates Debian 13+ and Podman availability
2. Installs required Podman packages
3. Generates Quadlet unit file via containers.podman collection
4. Reloads systemd daemon (triggers Quadlet generator)
5. Enables and starts systemd service

## Generated Files

- Quadlet unit: `/etc/containers/systemd/<name>.container`
- Systemd service: `/etc/systemd/system/<name>.service` (generated by Quadlet)

## License

MIT

## Author

neox5
