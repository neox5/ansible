---
# Preflight checks - validate environment before proceeding

- name: Gather distribution facts
  ansible.builtin.setup:
    gather_subset:
      - distribution

- name: Assert Debian 13 or later
  ansible.builtin.assert:
    that:
      - ansible_distribution == "Debian"
      - ansible_distribution_major_version | int >= 13
    fail_msg: "This role requires Debian 13 or later"
    success_msg: "Debian {{ ansible_distribution_major_version }} detected"

- name: Assert required variables are set
  ansible.builtin.assert:
    that:
      - n8n_webhook_url | length > 0
      - n8n_host | length > 0
      - n8n_encryption_key | length > 0
      - n8n_db_password | length > 0
    fail_msg: "Required variables must be configured: n8n_webhook_url, n8n_host, n8n_encryption_key, n8n_db_password"
    success_msg: "Required variables validated"

- name: Display role information
  ansible.builtin.debug:
    msg: "n8n role - deploying version {{ n8n_version }}"
