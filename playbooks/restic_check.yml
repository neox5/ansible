---
# Restic Repository Verification
# Verify repository structure and optionally full data integrity
# Usage: ansible-playbook -i inventory/lab playbooks/restic_check.yml --limit lab-vm
#        ansible-playbook -i inventory/lab playbooks/restic_check.yml --limit lab-vm -e "check_data=true"

- name: Verify Restic repository integrity
  hosts: all
  become: yes

  vars:
    check_data: false # Set to true for full data verification (slow)

  tasks:
    - name: Execute repository check
      ansible.builtin.command:
        cmd: "{{ restic_script_dir }}/check.sh{{ ' --read-data' if check_data else '' }}"
      register: check_result

    - name: Display check results
      ansible.builtin.debug:
        var: check_result.stdout_lines
